# SPEC_003: File Attachment System

> **채팅에 파일 첨부하는 방식 정의**

---

## Overview

Claude 채팅에서 파일 컨텍스트를 전달하는 방식을 정의한다.
핵심 원칙: **명시적 첨부만 전송** (자동 전송 X)

---

## 1. 기본 원칙

| 항목 | 설명 |
|------|------|
| 자동 전송 | X (하지 않음) |
| 명시적 첨부 | O (사용자가 직접 추가) |

---

## 2. 첨부 방식 (3가지)

| # | 방식 | 설명 | 상태 |
|---|------|------|------|
| 1 | **열린 파일 버튼** | 채팅창 상단에 `+ 파일명` 버튼 클릭 | 구현중 |
| 2 | **드래그 앤 드롭** | 파일 탐색기에서 채팅창으로 드래그 | ✅ 완료 |
| 3 | **Ctrl+C/V** | 파일/이미지 복사 후 붙여넣기 | ✅ 완료 |

---

## 3. UI 구조

### 3.1 레이아웃

```
┌─────────────────────────────────────────────┐
│ + a.cs   + b.ts   + c.json                 │  ← 열린 파일 버튼들 (방식 1)
├─────────────────────────────────────────────┤
│ [첨부됨: a.cs] [첨부됨: b.ts]  ✕            │  ← 첨부된 파일 표시 (제거 가능)
├─────────────────────────────────────────────┤
│                                             │
│ 채팅 히스토리                                │
│                                             │
├─────────────────────────────────────────────┤
│ 메시지 입력...                         [전송] │
└─────────────────────────────────────────────┘
```

### 3.2 열린 파일 버튼 영역 (방식 1)

- 위치: 채팅창 상단
- 표시 내용: 현재 에디터에서 열린 파일들
- 버튼 형식: `+ {파일명}`
- 순서: 탭 순서 또는 최근 사용 순
- 동작: 클릭 시 첨부 목록에 추가

### 3.3 드래그 앤 드롭 (방식 2)

- 파일 탐색기 또는 외부에서 채팅창으로 드래그
- 드롭 시 첨부 목록에 추가
- 드롭 영역 하이라이트 표시

### 3.4 Ctrl+C/V (방식 3)

- 파일 복사 후 채팅창에서 Ctrl+V
- 이미지: 클립보드에서 직접 붙여넣기 (Win+Shift+S 캡처 등)
- 텍스트 파일: 내용 첨부

### 3.5 첨부된 파일 표시 영역

- 위치: 열린 파일 버튼 아래
- 표시 내용: 첨부된 파일 목록
- 형식: `[첨부됨: {파일명}]` + 제거 버튼 (✕)

---

## 4. 동작 흐름

### 4.1 파일 첨부 (버튼 클릭)

```
1. 사용자가 a.cs 파일을 에디터에서 열어둠
2. 채팅창 상단에 "+ a.cs" 버튼 표시
3. 버튼 클릭
4. 첨부 영역에 "[첨부됨: a.cs]" 추가
5. 내부적으로 첨부 목록에 파일 경로/내용 저장
```

### 4.2 파일 제거

```
1. 첨부된 파일 옆 ✕ 버튼 클릭
2. 첨부 목록에서 제거
3. UI에서 해당 태그 제거
```

### 4.3 메시지 전송

```
1. 사용자가 메시지 입력 후 전송
2. 첨부된 파일들의 내용을 컨텍스트로 포함
3. Claude API 호출
4. 전송 후 첨부 목록 초기화 (또는 유지 - TBD)
```

---

## 5. 데이터 모델

```typescript
interface ChatAttachment {
  id: string;
  fileName: string;
  filePath: string;
  content: string;        // 파일 내용
  language?: string;      // 언어 (syntax highlighting용)
  selection?: {           // 부분 선택 시 (향후 확장)
    startLine: number;
    endLine: number;
  };
}

interface ChatContext {
  attachments: ChatAttachment[];
  // ... 기타 컨텍스트
}
```

---

## 6. 향후 확장 고려

| 기능 | 설명 | 우선순위 |
|------|------|----------|
| 선택 영역 첨부 | 파일 전체가 아닌 선택한 부분만 첨부 | P2 |
| 이미지 첨부 | 스크린샷/이미지 파일 첨부 | ✅ 완료 |
| 폴더 첨부 | 폴더 전체를 컨텍스트로 | P3 |

---

## 7. 참고

- VS Code Chat의 `#file` 태그 방식과 유사하나, 버튼 UI로 더 직관적으로 구현
- Cursor의 자동 컨텍스트 방식과 다르게 명시적 첨부만 지원

---

**Status**: In Progress
**Created**: 2025-01-26
**Updated**: 2025-01-26
**Author**: Kent
